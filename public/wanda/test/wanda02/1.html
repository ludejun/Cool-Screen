<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>02</title>
<script type="text/javascript" src="../../jquery/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../js/mt.js"></script>
<script type="text/javascript" src="../../js/ani.js"></script>
<script type="text/javascript" src="../../js/gd.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<style type="text/css">

body{
	background-color: #333;
}
canvas{
	display: block;
	
	/*background-color: #333;*/
	/*width: 1100px;*/
	/*height: 900px;*/
	/*transform-origin: 0px 0px;*/
	transform: rotateX(23deg);
	/*border: 2px solid #fff;*/
	background-color: rgba(0,0,0,0.1);
}
.full{
	position: absolute;
	left: 0px;
	top: 0px;
	width: 1920px;
	height: 1080px;
	background-image: url(image/bg.jpg);
	overflow: hidden;

}

#cvsContainer{
	position: absolute;
	left: 520px;
	top: 130px;
	width: 1300px;
	height: 600px;
	perspective: 800;
	-webkit-perspective: 800;
	-moz-perspective: 800;
}

#time{
	width: 1762px;
	height: 96px;
	background: transparent url(image/timelight.png) left top no-repeat;
	position: absolute;
	left: 50%;
	margin-left: -881px;
	bottom: 70px;
	color: #fff;
	font-family: "MicrosoftYaHei", Arial;
	background-color: rgba(0,0,255,0.1);
}

#time .grid{
	width: 158px;
	border-right: 1px solid #101a3b;
	height: 94px;
	line-height: 94px;
	background-color: rgba(0,105,224,0.3);
	float: left;
	text-align: center;
	font-size: 30px;
	cursor: pointer;
	transition: font-size 0.1s;
	-webkit-transition: font-size 0.1s;
	-moz-transition: font-size 0.1s;
}

#time .grid.active{
	border: 5px solid #ffae00;
	margin-top: -2px;
	background-color: #9d7930;
	font-weight: bold;
	font-size: 40px;
}
.hidden{
	display: none;
}

</style>
</head>
<body>
<div class="full">
	<div id="cvsContainer">
		<canvas width="1300" height="600"></canvas>
	</div>
	<div id="time">
		<div id="timebar">
			<div id="T0800" class="grid">08:00</div>
			<div id="T0900" class="grid">09:00</div>
			<div id="T1000" class="grid">10:00</div>
			<div id="T1100" class="grid">11:00</div>
			<div id="T1200" class="grid">12:00</div>
			<div id="T1300" class="grid active">13:00</div>
			<div id="T1400" class="grid">14:00</div>
			<div id="T1500" class="grid">15:00</div>
			<div id="T1600" class="grid">16:00</div>
			<div id="T1700" class="grid">17:00</div>
			<div id="T1800" class="grid">18:00</div>
		</div>
	</div>
</div>


<script type="text/javascript">

var pageSize = 500;
var pageIndex = 0;
var timeArg = 300;
var ZOOMX = 28;
var ZOOMY = 16;
var trackBuffer = 4;
var pointSize = 8;

var COLORS = [];
var CIDX = 0;
for(var i = 0; i < 3; i++){
	for(var j = 64; j < 256; j+=16){
		var c = [255,255,255];
		c[i] = j;
		COLORS.push('rgba(' + c.join(',') + ',0.3)');
	}
}
COLORS.sort(function(){return 0.5-Math.random()})
// console.log(COLORS);

var canvas = document.querySelector('canvas');
var ctx = canvas.getContext('2d');

function eachData(data, fn){
	MT.EACH(data, function(v){
		MT.EACH(v.coordinates, function(p){
			fn(p);
		});
	});
};

GD.translateCenterCanvas(ctx);
ctx.rotate(Math.PI / 180 * 18);
// ctx.translate(-20 * ZOOMX, 130);
ctx.translate(0, 80);
var bgFresh = Ani.addBase(function(){
	ctx.clearRect(-2000, -2000, 6000, 6000);
	return -1;
});

var json = '[[[7.35402,-3.21303],[23.2721,-8.03368],[29.6862,13.1231],[23.9046,-10.8756]],[[7.37464,21.7312],[11.424,21.8608],[3.87867,17.4641],[0.317688,15.2187]],[[2.13488,15.308],[-0.212094,16.4853],[-0.582756,15.7308],[6.59186,18.0844]],[[17.026,-1.14979],[29.2633,8.97132],[28.9831,-0.228206],[30.2838,7.67685]],[[-0.655597,20.277],[-2.11212,17.0133],[-0.590567,14.175],[0.0478665,14.3133]],[[12.1537,-1.04478],[11.3113,-0.421516],[12.0462,-0.010807],[16.2761,3.73743]],[[-4.99832,11.5211],[5.60334,0.569521],[4.28146,20.603],[8.8737,16.7052]],[[5.202,24.2264],[3.80072,23.5919],[3.76238,23.5035],[7.46451,23.5774]],[[-0.34894,25.7703],[1.16355,25.0451],[-1.47582,19.7139],[-1.47582,19.7139]],[[8.8737,16.7052],[11.4048,26.866],[10.4942,23.2104],[10.406,22.8562]]]';

function run(data){
	data = data.map(function(a){
		return { coordinates: a.map(function(aa){
			return { x: aa[0], y: aa[1] }
		}) }
	})
	console.log(data);

	var area = GD.dataRect(data, eachData);
	MT.EACH(data, function(v){
		MT.EACH(v.coordinates, function(p){
			p.x = area.center - parseFloat(p.x);
			p.y = area.middle - parseFloat(p.y);
		});
		v.coordinates.distance = Distance(v.coordinates);
	});


	Draw(data);

	$('.grid').removeClass('hidden');
}

function loadData(id){

	$('.grid').removeClass('active');
	$('#T' + id).addClass('active');

	id = 'data';
	// $.get('data/' + id + '.txt', function(txt){
	$.get('http://54.222.225.62:9000/custom/flowline', function(txt){
		// var data = cleanData(txt);
		// data = JSON.parse(data);

		var data = JSON.parse(txt);
		
		
		run(data);

	});
}

// loadData('0800');

run(JSON.parse(json))


$('.grid').on('click', function(){
	var id = this.id.substr(1);
	pageIndex = 0;
	Ani.clear(function(){
		loadData(id);
	});
});

GD.fullFitDom('.full');




</script>


</body>
</html>