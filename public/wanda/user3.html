<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>大数据现场实时统计</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/user3.css">
</head>
<body class="bg">
<div class="container">
    <div class="header">
        <div class="title title-lg">大数据现场实时统计</div>
        <div class="logo">万达商业年会</div>
    </div>
    <h1 class="title" style="margin-left: 15px;">您想了解现场人群的年龄和性别比例吗？</h1>

    <img src="./img/left-line-3.png" alt=" " style="position: absolute;left: 694px; top: 654px;">
    <img src="./img/right-line-3.png" alt=" " style="position: absolute;right: 682px; top: 627px;">

    <div class="fudao" id="fudao-nianling">
        <div class="fudao-legend">
            <h2>年龄分布</h2>
            <div class="fudao-container">

            </div>
        </div>
        <div id="pie-nianling"></div>
    </div>

    <div class="fudao flipx" id="fudao-nannv">
        <div class="fudao-legend flipx">
            <h2>男女比例</h2>
            <div class="fudao-container">

            </div>
        </div>
        <div id="pie-nannv"></div>
    </div>

    <div>
        <div class="legend">
            现场人群
            <span class="block" style="background:#ffc50e;margin: 0 18px;"></span>
            vs
            <span class="block" style="background: #28a3f9;margin: 0 18px;"></span>
            北京人群
        </div>
        <div class="user"></div>
    </div>

    <div class="scan-bar"></div>
</div>

<script src="./js/jquery.min.js"></script>
<script src="./js/highcharts.js"></script>
<script src="./js/main.js"></script>

<script>
    function zoom() {
        var width = $(window).width();
        var height = $(window).height();
        if (height > width) {
            $('html').css({zoom: width / 1080});
            $('html').height(1080);
            $('html').css({top: '-1080px'});
        } else {
            $('html').css({zoom: width / 1920});
        }
    }
    $(function(){
        zoom();
        window.onresize = function() {
            zoom();
        };

        loadNianling();
        loadStat();
        setInterval(function(){
            loadNianling();
            loadStat();
        }, 1000 * 60 * 10);

        function loadStat() {
            $.get('./json/td/custom_stat_'+getId()+'.json', function(data){
                $.get('./json/td/custom_stat_bj.json', function(dataBj){
                    pie('#pie-nannv', 0, 0);
                    var total = data['male'] + data['female'];
                    var totalBj = dataBj['male'] + dataBj['female'];
                    data['male'] = (data['male'] / total * 100).toFixed(0);
                    data['female'] = (data['female'] / total * 100).toFixed(0);
                    dataBj['male'] = (dataBj['male'] / totalBj * 100).toFixed(0);
                    dataBj['female'] = (dataBj['female'] / totalBj * 100).toFixed(0);
                    html = '<div class="legend-body legend-1">' +
                            '<span class="title">男性</span>' +
                            '<span class="bar"><span style="width:'+data['male']+'%"></span></span>' +
                            '<span class="percent">'+data['male']+'%</span>' +
                            '</div>' +
                            '<div class="legend-body legend-2">' +
                            '<span class="title"></span>' +
                            '<span class="bar"><span style="width:'+dataBj['male']+'%"></span></span>' +
                            '<span class="percent">'+dataBj['male']+'%</span>' +
                            '</div>' +
                            '<div class="legend-body legend-1">' +
                            '<span class="title">女性</span>' +
                            '<span class="bar"><span style="width:'+data['female']+'%"></span></span>' +
                            '<span class="percent">'+data['female']+'%</span>' +
                            '</div>' +
                            '<div class="legend-body legend-2">' +
                            '<span class="title"></span>' +
                            '<span class="bar"><span style="width:'+dataBj['female']+'%"></span></span>' +
                            '<span class="percent">'+dataBj['female']+'%</span>' +
                            '</div>';
                    $('#fudao-nannv .fudao-container').html(html);

                }, 'json');
            }, 'json');
        }

        function loadNianling() {
            $.get('./json/td/custom_age_'+getId()+'.json', function(data){
                pie('#pie-nianling', 0, 0);
                $.get('./json/td/custom_age_bj.json', function(dataBj){
                    var html = '';
                    for (var i = 0; i < data.length; i++) {
                        html += '<div class="legend-body legend-1">' +
                                '<span class="title">'+data[i].age+'</span>' +
                                '<span class="bar"><span style="width:'+Math.round(data[i].ratio)+'%"></span></span>' +
                                '<span class="percent">'+Math.round(data[i].ratio)+'%</span>' +
                                '</div>' +
                                '<div class="legend-body legend-2">' +
                                '<span class="title"></span>' +
                                '<span class="bar"><span style="width:'+Math.round(dataBj[i].ratio)+'%"></span></span>' +
                                '<span class="percent">'+Math.round(dataBj[i].ratio)+'%</span>' +
                                '</div>';
                    }
                    $('#fudao-nianling .fudao-container').html(html);
                }, 'json');
            }, 'json');
        }

        function pie(id, percent, percentInner) {
            $(id).highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    height: 232,
                    width: 232,
                    backgroundColor: 'transparent',
                    spacing: [0, 0, 0, 0]
                },
                title: {
                    text: ''
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                subtitle: {
                    useHTML: true,
                    text: '<span class="pie-bg"></span>'

                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        borderWidth: 0,
                        dataLabels: {
                            enabled: false
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    colors: ['#ffc50e', 'rgba(255, 255, 255, 0)'],
                    size: '87%',
                    innerSize: '90%',
                    data: [
                        ['use',   percent],
                        ['other', 100 - percent]
                    ]
                }, {
                    type: 'pie',
                    colors: ['#28a3f9', 'rgba(255, 255, 255, 0)'],
                    size: '63%',
                    innerSize: '88%',
                    data: [
                        ['use',   percentInner],
                        ['other', 100 - percentInner]
                    ]
                }]
            });
        }
    });
</script>
</body>
</html>
