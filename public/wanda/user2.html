<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>大数据现场实时统计</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/user2.css">
</head>
<body class="bg">
<div class="container">
    <div class="header">
        <div class="title title-lg">大数据现场实时统计</div>
        <div class="logo">万达商业年会</div>
    </div>
    <h1 class="title" style="margin-left: 15px;">想知道现场人群的常去地点和手机统计么？</h1>

    <img src="./img/favor-title.png" alt=" " style="position: absolute;left: 994px;top: 201px;">
    <img src="./img/dao.png" alt=" " style="position: absolute; right: 57px; top: 240px;">
    <div class="favor" id="favor-container">

    </div>

    <img src="./img/price-title.png" alt=" " style="position: absolute;left: 1182px;top: 577px;">
    <div class="price" id="price-container">
        <ul>

        </ul>
    </div>

    <img src="./img/changqu-title.png" alt=" " style="position: absolute;left: 465px;top: 327px;">
    <div class="changqu">
        <div class="changqu-1">
            <div class="pie" id="pie-1"></div>
            <div class="info">

            </div>
        </div>
        <div class="changqu-2">
            <div class="pie" id="pie-2"></div>
            <div class="info">

            </div>
        </div>
        <div class="changqu-3">
            <div class="pie" id="pie-3"></div>
            <div class="info">

            </div>
        </div>
        <div class="changqu-4">
            <div class="pie" id="pie-4"></div>
            <div class="info">

            </div>
        </div>
        <div class="changqu-5">
            <div class="pie" id="pie-5"></div>
            <div class="info">

            </div>
        </div>
    </div>

    <div>
        <div class="user"></div>
    </div>

    <div class="scan-bar"></div>
</div>

<script src="./js/jquery.min.js"></script>
<script src="./js/highcharts.js"></script>
<script src="./js/main.js"></script>
<script>
    function zoom() {
        var width = $(window).width();
        var height = $(window).height();
        if (height > width) {
            $('html').css({zoom: width / 1080});
            $('html').height(1080);
            $('html').css({top: '-1080px'});
        } else {
            $('html').css({zoom: width / 1920});
        }
    }
    $(function(){
        zoom();
        window.onresize = function() {
            zoom();
        };

        loadBrand();
        loadPrice();
        loadPlace();
        setInterval(function(){
            loadBrand();
            loadPrice();
            loadPlace();
        }, 1000 * 60 * 10);

        function loadBrand() {
            var brand = {
                '小米': './img/brand-xiaomi',
                '苹果': './img/brand-apple',
                '三星': './img/brand-samsung',
                '华为': './img/brand-huawei',
                'vivo': './img/brand-vivo'
            };
            $.get('./json/td/mobile_brand_'+getId()+'.json', function(data){
                var html = '';
                for (var i = 0; i < data.length; i++) {
                    var b = '';
                    if (i == 0) {
                        b = '-y';
                    }
                    var position = '';
                    if (data[i].brand == '三星') {
                        if (i == 0){
                            position = 'left: -10px;';
                        } else if (i == 2) {
                            position = 'left: -25px';
                        }
                    }
                    if (data[i].brand == 'vivo') {
                        if (i == 2) {
                            position = 'left: -15px';
                        }
                    }
                    html += '<div class="favor-' +(i+1)+ '">' +
                            '<img style="'+position+'" src="'+ brand[data[i].brand] + b +'.png" alt="">' +
                            '<p>'+data[i].brand+'</p>' +
                            '</div>';
                }
                $('#favor-container').html(html);
            }, 'json');
        }

        function loadPrice() {
            $.get('./json/td/mobile_price_'+getId()+'.json', function(data){
                var html = '';
                for (var i = 0; i < data.length; i++) {
                    html += '<li><b>'+data[i].price+'</b><span style="width:'+(data[i].ratio*100)+'%;"></span></li>';
                }
                $('#price-container > ul').html(html);
            }, 'json');
        }

        function loadPlace() {
            var place = {
                '高端场所': 'HIGH PLACES',
                '飞机场': 'AIRPORT',
                '星级酒店': 'START HOTELS',
                '高尔夫球会': 'GOLF CLUB',
                '旅游景区': 'SCENIC SPOT'
            };
            var icon = {
                '高端场所': 'high-places',
                '飞机场': 'airport',
                '星级酒店': 'start-hotels',
                '高尔夫球会': 'golf-club',
                '旅游景区': 'scenic-spot'
            };
            $.get('./json/td/mobile_place_'+getId()+'.json', function(data){
                data.sort(function(a, b){
                    return b.ratio - a.ratio;
                });

                for (var i = 0; i < data.length; i++) {
                    data[i].ratio = Math.round(data[i].ratio * 10) / 10;
                    $('#pie-' + (i+1)).addClass(icon[data[i].place]);
                    var color = i == 0 ? '#ffc50e' : '#00c0ff';
                    pie('#pie-' + (i + 1), data[i].ratio, color);
                    var html = '<h2>'+data[i].ratio+'%</h2>' +
//                               '<p style="font-family: Roboto;font-weight: bolder;">'+place[data[i].place]+'</p>' +
                               '<p style="font-family: FZLanTingHei-L-GBK">'+data[i].place+'</p>';
                    $('.changqu-' + (i+1) + ' .info').html(html);
                }
            }, 'json');
        }

        function pie(id, percent, color) {
            $(id).highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    height: 176,
                    width: 176,
                    backgroundColor: 'transparent',
                    spacing: [0, 0, 0, 0]
                },
                title: {
                    text: ''
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                subtitle: {
                    useHTML: true,
                    text: '<span class="pie-bg"></span>'

                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        borderWidth: 0,
                        dataLabels: {
                            enabled: false
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    colors: [color, 'rgba(255, 255, 255, 0)'],
                    size: '87%',
                    innerSize: '95%',
                    data: [
                        ['use',   percent],
                        ['other', 100 - percent]
                    ]
                }]
            });
        }
    });
</script>
</body>
</html>
