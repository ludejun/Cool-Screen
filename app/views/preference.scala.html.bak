@(title: String)
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>#{get 'title' /}</title>
    <link rel="stylesheet" href=@routes.Assets.at("css/main.css")>
    <link rel="stylesheet" href=@routes.Assets.at("css/preference.css")>
</head>
<body class="bg">
<div class="container">
    <div class="header">
        <div class="title">@title</div>
        <div class="logo">万达商业年会</div>
    </div>


    <div class="area-container">

        <div id="radar"></div>
    </div>

    <div class="right">
        <div class="pie-container">
            <div id="pie-apple"></div>
            <div class="info">
                <p><img src=@routes.Assets.at("img/apple.png") alt="icon"></p>
                <p>苹果用户<span style="color: #00c0ff;">特征</span></p>
                <p id="pie-apple-name">地图导航</p>
            </div>
        </div>
        <div class="pie-container">
            <div id="pie-mi"></div>
            <div class="info">
                <p><img src=@routes.Assets.at("img/xiaomi.png") alt="icon"></p>
                <p>小米用户<span style="color: #45e630;">特征</span></p>
                <p id="pie-mi-name">网络购物</p>
            </div>
        </div>
        <div class="pie-container">
            <div id="pie-samsung"></div>
            <div class="info">
                <p><img src=@routes.Assets.at("img/samsung.png") alt="icon"></p>
                <p>三星用户<span style="color: #ffae00;">特征</span></p>
                <p id="pie-samsung-name">金融理财</p>
            </div>
        </div>
    </div>

    <div class="scan-bar"></div>

</div>

<script src=@routes.Assets.at("js/jquery.min.js")></script>
<script src=@routes.Assets.at("js/highcharts.js")></script>
<script src=@routes.Assets.at("js/highcharts-more.js")></script>
<script src=@routes.Assets.at("js/main.js")></script>

<script>
    function zoom() {
        var width = $(window).width();
        var height = $(window).height();
        if (height > width) {
            $('html').css({zoom: width / 1080});
            $('html').height(1080);
            $('html').css({top: '-1080px'});
        } else {
            $('html').css({zoom: width / 1920});
        }
    }

    $(function () {

        zoom();
        window.onresize = function() {
            zoom();
        };

        pie('#pie-samsung', 0, '#ffae00');
        pie('#pie-apple', 0, '#00c0ff');
        pie('#pie-mi', 0, '#45e630');
        loadData();
        setInterval(function(){
            loadData();
        }, 1000 * 10 );

        function loadData() {
            $.get('assets/json/td/app_favor_1'+'.json', function(data){
                data = prepare(data);
                radar(data);
                pieAll(data);
            });
        }

        function prepare(data) {
            for (var i = 0; i < data.length; i++) {
                var favor_arr = data[i].favor_arr;
                data[i].max = 0;
                var max_num = 0;
                var min_ratio_v0 = 0;
                var min_ratio_v1 = 0;
                var min_ratio_v2 = 0;
                var min_ratio_v3 = 0;
                data[i].max_sum = data[i].max;
                for (var j = 0; j < favor_arr.length; j++) {
                    favor_arr[j].ratio = favor_arr[j].ratio / 100;
                    if (favor_arr[j].ratio > data[i].max) {
                        max_num = max_num + 1
                        if(max_num == 1) {
                          min_ratio_v0 = data[i].max;
                          alert("1");
                        } else if (max_num == 2) {
                          min_ratio_v1 = data[i].max;
                          alert("2");
                        } else if (max_num == 3) {
                          min_ratio_v2 = data[i].max;
                          alert("3");
                        } else if (max_num == 4) {
                          min_ratio_v3 = data[i].max;
                          alert("4");
                        }
                        data[i].favor = favor_arr[j].favor+"等";
                        if(max_num > 4) {
                          data[i].max_sum      = data[i].max_sum - min_ratio_v0;
                          alert("5");
                          alert(data[i].max_sum);
                          min_ratio_v0 = min_ratio_v1;
                          min_ratio_v1 = min_ratio_v2;
                          min_ratio_v2 = min_ratio_v3;
                          min_ratio_v3 = data[i].max;
                        }
                        data[i].max = favor_arr[j].ratio;
                        data[i].max_sum = data[i].max_sum + data[i].max;
                    }
                }
            }
            return data;
        }

        function pieAll(data) {
            for (var i = 0; i < data.length; i++) {
                if (data[i].brand == 'iphone') {
                    var k = i;
                    setTimeout(function(){
                        pie('#pie-apple', data[k].max_sum, '#00c0ff');
                        $('#pie-apple-name').text(data[k].favor);
                    }.bind(data).bind(k), 500);
                } else if (data[i].brand == 'mi') {
                    var m = i;
                    setTimeout(function(){
                        pie('#pie-mi', data[m].max_sum, '#45e630');
                        $('#pie-mi-name').text(data[m].favor);
                    }.bind(data).bind(m), 1000);
                } else {
                    var n = i;
                    setTimeout(function(){
                        pie('#pie-samsung', data[n].max_sum, '#ffae00');
                        $('#pie-samsung-name').text(data[n].favor);
                    }.bind(data).bind(n), 1500);
                }
            }
        }


        function radar(data) {
            var categories = [];
            var dataApple = [];
            var dataMi = [];
            var dataSamsung = [];
            for (var i = 0; i < data.length; i++) {
                var favor_arr = data[i].favor_arr;
                if (data[i].brand == 'iphone') {
                    for (var j = 0; j < favor_arr.length; j++) {
                        dataApple[j] = favor_arr[j].ratio;
                        categories[j] = favor_arr[j].favor;
                    }
                } else if (data[i].brand == 'mi') {
                    for (var j = 0; j < favor_arr.length; j++) {
                        dataMi[j] = favor_arr[j].ratio;
                    }
                } else {
                    for (var j = 0; j < favor_arr.length; j++) {
                        dataSamsung[j] = favor_arr[j].ratio;
                    }
                }
            }
            $('#radar').highcharts({

                chart: {
                    polar: true,
                    type: 'area',
                    height: 781,
                    width: 1200,
                    backgroundColor: 'transparent',
                    spacing: [0, 0, 0, 0]
                },

                title: {
                    text: ''
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                pane: {
                    size: '80%'
                },
                plotOptions: {
                    area: {
                        marker: {
                            enabled: false
                        }
                    }
                },

                xAxis: {
                    lineWidth: 0,
                    gridLineWidth: 1,
                    gridLineColor: '#3986eb',
                    categories: categories,
                    tickmarkPlacement: 'on',
                    labels: {
                        useHTML: true,
                        style: {
                            fontFamily: 'FZLanTingHei-L-GBK',
                            color: '#fff',
                            fontSize: '2.4rem',
                            fontWeight: 'normal'
                        },
                        formatter: function(){
                            var id = categories.indexOf(this.value);
                            return '<span class="radar-label label-' + id + '">' + this.value + '</span>';
                        }
                    }
                },

                yAxis: {
                    tickInterval: 0.5,
                    gridLineWidth: 1,
                    gridLineColor: '#3986eb',
                    minorTickInterval: 0.25,
                    minorGridLineWidth: 1,
                    minorGridLineColor: '#3986eb',
                    minorGridLineDashStyle: 'Dash',
                    gridLineInterpolation: 'polygon',
                    lineWidth: 0,
                    min: 0,
                    max: 1,
                    labels: {
                        enabled: false
                    }
                },

                series: [{
                    name: 'bg',
                    pointPlacement: 'on',
                    data: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                    color: 'rgba(0, 132, 255, 0.1)',
                    fillColor: 'rgba(0, 132, 255, 0.1)'
                }, {
                    name: '小米',
                    pointPlacement: 'on',
                    data: dataMi,
                    color: 'rgba(0, 192, 255, 1)',
                    lineColor: 'rgba(0, 192, 255, 1)',
                    fillColor: 'rgba(0, 192, 255, 0.5)'
                }, {
                    name: '苹果',
                    pointPlacement: 'on',
                    data: dataApple,
                    color: 'rgba(69, 230, 48, 1)',
                    lineColor: 'rgba(69, 230, 48, 1)',
                    fillColor: 'rgba(69, 230, 48, 0.5)'
                }, {
                    name: '三星',
                    pointPlacement: 'on',
                    data: dataSamsung,
                    color: 'rgba(255, 174, 0, 1)',
                    lineColor: 'rgba(255, 174, 0, 1)',
                    fillColor: 'rgba(255, 174, 0, 0.5)'
                }]

            });
        }

        function pie(id, percent, color) {
            percent = Math.round(percent * 100)
            $(id).highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    height: 222,
                    width: 222,
                    backgroundColor: 'transparent',
                    spacing: [0, 0, 0, 0]
                },
                title: {
                    text: ''
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                subtitle: {
                    useHTML: true,
                    text: '<span class="pie-title">' + percent + '%</span>'

                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        borderWidth: 0,
                        dataLabels: {
                            enabled: false
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    colors: [color, 'rgba(255, 255, 255, 0)'],
                    innerSize: '95%',
                    data: [
                        ['use',   percent],
                        ['other', 100 - percent]
                    ]
                }]
            });
        }
    });

</script>
</body>
</html>
